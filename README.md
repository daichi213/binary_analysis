# Binary Analysis

[はじめて学ぶバイナリ解析](https://www.amazon.co.jp/%E3%81%AF%E3%81%98%E3%82%81%E3%81%A6%E5%AD%A6%E3%81%B6%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E8%A7%A3%E6%9E%90-%E4%B8%8D%E6%AD%A3%E3%81%AA%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%92%E5%AE%88%E3%82%8B%E3%82%B5%E3%82%A4%E3%83%90%E3%83%BC%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E6%8A%80%E8%A1%93-OnDeck-Books%EF%BC%88NextPublishing%EF%BC%89-%E5%B0%8F%E6%9E%97-%E4%BD%90%E4%BF%9D-ebook/dp/B084R85269)を通して学習した内容をこのレポジトリにまとめます。個人的に C 言語をひととおり学習した後だとイメージがつきやすかったです。

## Memo

### アセンブラーのコンパイル

アセンブラーのコンパイルには nasm ライブラリを使用して、一度オブジェクトファイルに変換した後、gcc によりバイナリへコンパイルすることで実行できる。
以下、hi_6-1.s ファイルをバイナリへ変換する手順になる。

```bash
nasm -g -f elf32 hi_6-1.s
gcc hi_6-1.o -o test
```

### システムコール

コンソールへの出力などを実行する際、OS が提供しているシステムコール（API：規約）を介してそれを実現させる。
以下は画面へ文字を出力させるプログラム例である。

```s
global main

main:
  push 0x00006948
  mov eax, 0x4
  mov ebx, 0x1
  mov ecx, esp
  mov edx, 0x4
#   システムコールを呼び出すための特殊な命令
  int 0x80
  add esp, 0x4
```

- データの入出力を行うシステムコールは`write`で、汎用レジスタ`EAX`に 0x4 を指定することで呼び出すことができる。
  - EAX・・・システムコールの種別
- `EBX` ~ `EDX` はシステムコールの引数として認識され、それぞれ以下の意味合いとなっている
  - EBX・・・書き出し先のファイルディスクリプタ
  - ECX・・・書き出すデータが格納されたバッファへのポインタ
  - EDX・・・書き出すバイト数
- なお、EBX~EDX に指定するべき引数はシステムコール毎にことなるため、使用するシステムコール毎に調べて指定する。

#### 手順

各 os, cpu 毎でシステムコールの呼び出し方法は異なるため、それぞれに対応したものを調べる必要がある。

- [それぞれの OS でのシステムコール呼び出し参考手順](https://freestylewiki.xyz/fswiki/wiki.cgi?page=%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%A9%EF%BC%88%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%B3%E3%83%BC%E3%83%AB%EF%BC%89)
  - [文字コード](https://www.k-cube.co.jp/wakaba/server/ascii_code.html)
  - [32bit,64bit のシステムコール呼び出し方法まとめ](https://www.mztn.org/lxasm64/x86_x64_table.html)
